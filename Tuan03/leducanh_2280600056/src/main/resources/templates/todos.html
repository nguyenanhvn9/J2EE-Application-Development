<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Todo App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container py-4">
    <h2 class="mb-4">Todo App</h2>
    <div class="mb-4">
      <a href="/" class="btn btn-secondary">Về trang chủ</a>
    </div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Form thêm công việc -->
    <form th:action="@{/todos/add}" method="post" class="input-group mb-3">
      <input
        type="text"
        name="title"
        class="form-control"
        placeholder="Thêm công việc..."
        required
      />
      <button class="btn btn-primary" type="submit">Thêm</button>
    </form>

    <!-- Thanh tìm kiếm -->
    <form method="get" th:action="@{/todos}" class="input-group mb-3">
      <input
        type="text"
        name="search"
        class="form-control"
        placeholder="Tìm công việc..."
      />
      <button class="btn btn-outline-secondary" type="submit">Tìm</button>
    </form>

    <!-- Tabs: All | Active | Completed -->
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <a
          class="nav-link"
          th:classappend="${filter == 'all'} ? 'active'"
          th:href="@{/todos(filter='all')}"
          >Tất cả</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          th:classappend="${filter == 'active'} ? 'active'"
          th:href="@{/todos(filter='active')}"
          >Đang làm</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          th:classappend="${filter == 'completed'} ? 'active'"
          th:href="@{/todos(filter='completed')}"
          >Đã hoàn thành</a
        >
      </li>
    </ul>

    <!-- Danh sách công việc -->
    <ul class="list-group mb-3">
      <li
        class="list-group-item d-flex justify-content-between align-items-center"
        th:each="todo : ${todos}"
      >
        <span
          th:text="${todo.title}"
          th:classappend="${todo.completed} ? 'text-decoration-line-through text-muted' : ''"
        ></span>
        <form
          th:if="${!todo.completed}"
          th:action="@{/todos/complete/{id}(id=${todo.id})}"
          method="post"
        >
          <button
            class="btn btn-sm btn-success"
            th:disabled="${completedCount >= maxCompleted}"
          >
            Hoàn thành
          </button>
        </form>
      </li>
    </ul>

    <!-- Footer -->
    <div class="d-flex justify-content-between align-items-center">
      <span
        ><strong th:text="${activeCount}">0</strong> công việc chưa hoàn
        thành</span
      >
      <form th:action="@{/todos/clear-completed}" method="post">
        <button class="btn btn-danger btn-sm">
          Xoá tất cả công việc đã hoàn thành
        </button>
      </form>
    </div>
  </body>
</html>
