<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Quản lý Đăng ký học</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="container py-4">
<h2 class="mb-4">Quản lý Đăng ký học của Sinh viên</h2>
<div class="mb-4">
    <a th:href="@{/student-manager}" class="btn btn-secondary">Trở lại</a>
</div>
<!-- Form chọn sinh viên -->
<form th:action="@{/student-manager/enrollments}" method="get" class="mb-4">
    <div class="mb-3">
        <label for="studentId" class="form-label">Chọn sinh viên:</label>
        <select id="studentId" name="studentId" class="form-select" required>
            <option value="">-- Vui lòng chọn --</option>
            <option th:each="s : ${students}" th:value="${s.id}" th:text="${s.name}"
                    th:selected="${s.id == enrollmentForm.studentId}"></option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Tải danh sách lớp</button>
</form>

<!-- Form lưu đăng ký -->
<form th:action="@{/student-manager/enrollments/save}" th:object="${enrollmentForm}" method="post" onsubmit="selectAllEnrolledClasses()">
    <input type="hidden" th:field="*{studentId}"/>

    <div th:if="*{studentId != null}">
        <div class="row">
            <div class="col">
                <label>Các lớp học hiện có:</label>
                <select id="availableClasses" multiple size="10" class="form-control">
                    <option th:each="cls : ${availableClasses}" th:value="${cls.id}" th:text="${cls.name}"></option>
                </select>
            </div>
            <div class="col-auto d-flex flex-column justify-content-center">
                <button type="button" class="btn btn-outline-primary mb-2"
                        onclick="moveSelected('availableClasses', 'enrolledClasses')">&gt;</button>
                <button type="button" class="btn btn-outline-secondary"
                        onclick="moveSelected('enrolledClasses', 'availableClasses')">&lt;</button>
            </div>
            <div class="col">
                <label>Các lớp đã đăng ký:</label>
                <select id="enrolledClasses" th:field="*{enrolledClassIds}" multiple size="10" class="form-control">
                    <option th:each="cls : ${enrolledClasses}" th:value="${cls.id}" th:text="${cls.name}"></option>
                </select>
            </div>
        </div>

        <div class="mt-3">
            <button type="submit" class="btn btn-success">Lưu thay đổi</button>
        </div>
    </div>
</form>

<script>
    function moveSelected(fromId, toId) {
        const from = document.getElementById(fromId);
        const to = document.getElementById(toId);
        Array.from(from.selectedOptions).forEach(option => {
            from.removeChild(option);
            to.appendChild(option);
        });
    }

    function selectAllEnrolledClasses() {
        const enrolled = document.getElementById("enrolledClasses");
        for (let i = 0; i < enrolled.options.length; i++) {
            enrolled.options[i].selected = true;
        }
    }
</script>
</body>
</html>
